<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <title>Ù…ÙˆÙ‚Ø¹ÙŠ - ØªØ·Ø¨ÙŠÙ‚</title>
    <style>
        /* ØªÙ†Ø³ÙŠÙ‚ Ø²Ø± Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ© */
        #pwa-home-button {
            position: fixed;
            top: 15px;
            left: 15px;
            z-index: 10000;
            display: none;
        }
        
        .home-btn {
            background: #007AFF;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 20px;
            font-size: 14px;
            cursor: pointer;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
            font-weight: bold;
        }
        
        .home-btn:hover {
            background: #0056CC;
        }
        
        /* ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© Ø§Ù„Ù…Ø®ØµØµØ© */
        .pwa-popup-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 10001;
            display: none;
        }
        
        .pwa-popup-container {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 90%;
            height: 80%;
            background: white;
            border-radius: 15px;
            z-index: 10002;
            display: none;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        
        .pwa-popup-header {
            padding: 15px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .pwa-popup-close {
            background: #FF3B30;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 15px;
            cursor: pointer;
        }
        
        .pwa-popup-content {
            width: 100%;
            height: calc(100% - 60px);
        }
        
        .pwa-popup-iframe {
            width: 100%;
            height: 100%;
            border: none;
            border-radius: 0 0 15px 15px;
        }
    </style>
</head>
<body>
    <!-- Ù…Ø­ØªÙˆÙ‰ Ù…ÙˆÙ‚Ø¹Ùƒ Ø§Ù„Ø£ØµÙ„ÙŠ Ù‡Ù†Ø§ -->
    <h1>Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ù…ÙˆÙ‚Ø¹ÙŠ</h1>
    <p>Ù‡Ø°Ø§ Ù‡Ùˆ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ Ù„Ù…ÙˆÙ‚Ø¹Ùƒ...</p>
    
    <!-- Ø²Ø± Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ© -->
    <div id="pwa-home-button">
        <button class="home-btn" onclick="goToHomePage()">ğŸ  Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
    </div>
    
    <!-- Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© Ø§Ù„Ù…Ø®ØµØµØ© -->
    <div class="pwa-popup-overlay" id="pwaPopupOverlay"></div>
    <div class="pwa-popup-container" id="pwaPopupContainer">
        <div class="pwa-popup-header">
            <button class="home-btn" onclick="goToHomePage()">ğŸ  Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
            <button class="pwa-popup-close" onclick="closePwaPopup()">âœ• Ø¥ØºÙ„Ø§Ù‚</button>
        </div>
        <div class="pwa-popup-content">
            <iframe class="pwa-popup-iframe" id="pwaPopupIframe"></iframe>
        </div>
    </div>

    <script>
        // Ø§ÙƒØªØ´Ø§Ù Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ÙŠØ¹Ù…Ù„ ÙÙŠ ÙˆØ¶Ø¹ PWA
        function isRunningAsPWA() {
            return window.navigator.standalone || 
                   window.matchMedia('(display-mode: standalone)').matches;
        }
        
        // Ø¥Ø¸Ù‡Ø§Ø± Ø²Ø± Ø§Ù„Ø¹ÙˆØ¯Ø© Ø¥Ø°Ø§ ÙƒØ§Ù† PWA
        function checkPWAStatus() {
            if (isRunningAsPWA()) {
                document.getElementById('pwa-home-button').style.display = 'block';
                console.log('ÙŠØ¹Ù…Ù„ ÙƒØªØ·Ø¨ÙŠÙ‚ PWA - ØªÙ… ØªÙØ¹ÙŠÙ„ Ø²Ø± Ø§Ù„Ø¹ÙˆØ¯Ø©');
            }
        }
        
        // Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
        function goToHomePage() {
            const currentUrl = window.location.href;
            const baseUrl = window.location.origin + window.location.pathname.split('/').slice(0, -1).join('/');
            
            // Ø¥Ø°Ø§ Ù„Ù… Ù†ÙƒÙ† ÙÙŠ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©ØŒ Ø§Ø±Ø¬Ø¹ Ù„Ù‡Ø§
            if (window.location.pathname !== '/' && !window.location.pathname.endsWith('index.html')) {
                window.location.href = baseUrl;
            } else {
                // Ø¥Ø°Ø§ ÙƒÙ†Ø§ ÙÙŠ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©ØŒ Ù‚Ù… Ø¨Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„
                window.location.reload();
            }
        }
        
        // ÙØªØ­ Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© Ø§Ù„Ù…Ø®ØµØµØ©
        function openPwaPopup(url) {
            document.getElementById('pwaPopupOverlay').style.display = 'block';
            document.getElementById('pwaPopupContainer').style.display = 'block';
            document.getElementById('pwaPopupIframe').src = url;
        }
        
        // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø©
        function closePwaPopup() {
            document.getElementById('pwaPopupOverlay').style.display = 'none';
            document.getElementById('pwaPopupContainer').style.display = 'none';
            document.getElementById('pwaPopupIframe').src = '';
        }
        
        // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†Ø§ÙØ°Ø© Ø¨Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø®Ù„ÙÙŠØ©
        document.getElementById('pwaPopupOverlay').addEventListener('click', closePwaPopup);
        
        // Ù…Ù†Ø¹ Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†Ø§ÙØ°Ø© Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø­ØªÙˆÙ‰
        document.getElementById('pwaPopupContainer').addEventListener('click', function(e) {
            e.stopPropagation();
        });
        
        // ØªØ¬Ø§ÙˆØ² window.open Ø§Ù„Ø£ØµÙ„ÙŠ
        const originalWindowOpen = window.open;
        window.open = function(url, name, specs) {
            if (isRunningAsPWA()) {
                // ÙÙŠ ÙˆØ¶Ø¹ PWAØŒ Ø§ÙØªØ­ ÙÙŠ Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© Ø§Ù„Ù…Ø®ØµØµØ©
                openPwaPopup(url);
                return {
                    close: function() {
                        closePwaPopup();
                    },
                    closed: false
                };
            } else {
                // ÙÙŠ Ø§Ù„Ù…ØªØµÙØ­ Ø§Ù„Ø¹Ø§Ø¯ÙŠØŒ Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø³Ù„ÙˆÙƒ Ø§Ù„Ø·Ø¨ÙŠØ¹ÙŠ
                return originalWindowOpen.call(window, url, name, specs);
            }
        };
        
        // ØªØ¬Ø§ÙˆØ² window.alert
        const originalAlert = window.alert;
        window.alert = function(message) {
            if (isRunningAsPWA()) {
                // ÙÙŠ PWAØŒ Ø§Ø³ØªØ®Ø¯Ù… alert Ù…Ø®ØµØµ Ø£Ùˆ console.log
                console.log('Alert:', message);
                // ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ù‡Ø°Ø§ Ø¨Ù€ modal Ù…Ø®ØµØµ Ø¥Ø°Ø§ Ø£Ø±Ø¯Øª
                if (confirm('ØªØ·Ø¨ÙŠÙ‚: ' + message + '\n\nÙ‡Ù„ ØªØ±ÙŠØ¯ Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©ØŸ')) {
                    goToHomePage();
                }
            } else {
                originalAlert.call(window, message);
            }
        };
        
        // ØªØ¬Ø§ÙˆØ² window.confirm
        const originalConfirm = window.confirm;
        window.confirm = function(message) {
            if (isRunningAsPWA()) {
                console.log('Confirm:', message);
                // ÙÙŠ Ø¨ÙŠØ¦Ø© Ø­Ù‚ÙŠÙ‚ÙŠØ©ØŒ Ø§Ø³ØªØ®Ø¯Ù… modal Ù…Ø®ØµØµ
                return true; // Ø£Ùˆ false Ø­Ø³Ø¨ Ø§Ù„Ø­Ø§Ø¬Ø©
            } else {
                return originalConfirm.call(window, message);
            }
        };
        
        // Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ø§Ù„ØªÙŠ ØªÙØªØ­ ÙÙŠ Ù†Ø§ÙØ°Ø© Ø¬Ø¯ÙŠØ¯Ø©
        document.addEventListener('DOMContentLoaded', function() {
            const links = document.querySelectorAll('a[target="_blank"]');
            links.forEach(link => {
                link.addEventListener('click', function(e) {
                    if (isRunningAsPWA()) {
                        e.preventDefault();
                        openPwaPopup(this.href);
                    }
                });
            });
            
            // Ø¥Ø¶Ø§ÙØ© Ø²Ø± Ø§Ù„Ø¹ÙˆØ¯Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ù„Ù„Ù†Ù…Ø§Ø°Ø¬
            const forms = document.querySelectorAll('form');
            forms.forEach(form => {
                if (!form.querySelector('.home-btn')) {
                    const homeBtn = document.createElement('button');
                    homeBtn.type = 'button';
                    homeBtn.className = 'home-btn';
                    homeBtn.textContent = 'ğŸ  Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©';
                    homeBtn.onclick = goToHomePage;
                    homeBtn.style.margin = '10px';
                    form.appendChild(homeBtn);
                }
            });
        });
        
        // Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø²Ø± Ø§Ù„Ø±Ø¬ÙˆØ¹ ÙÙŠ Ø§Ù„Ù…ØªØµÙØ­
        window.addEventListener('popstate', function() {
            if (isRunningAsPWA()) {
                // ÙÙŠ PWAØŒ Ø§Ø³ØªØ®Ø¯Ù… Ø²Ø± Ø§Ù„Ø¹ÙˆØ¯Ø© Ø§Ù„Ù…Ø®ØµØµ
                goToHomePage();
            }
        });
        
        // Ø¥Ø¶Ø§ÙØ© Ø²Ø± Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ØµÙØ­Ø§Øª Ø§Ù„Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ©
        function addHomeButtonToNewContent() {
            if (isRunningAsPWA()) {
                const existingButton = document.querySelector('#pwa-home-button');
                if (!existingButton) {
                    const homeButton = document.createElement('div');
                    homeButton.id = 'pwa-home-button';
                    homeButton.innerHTML = '<button class="home-btn" onclick="goToHomePage()">ğŸ  Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>';
                    document.body.appendChild(homeButton);
                }
            }
        }
        
        // Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª ÙÙŠ DOM Ù„Ø¥Ø¶Ø§ÙØ© Ø²Ø± Ø§Ù„Ø¹ÙˆØ¯Ø©
        const observer = new MutationObserver(function(mutations) {
            mutations.forEach(function(mutation) {
                if (mutation.addedNodes.length) {
                    addHomeButtonToNewContent();
                }
            });
        });
        
        // Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø© Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
        window.addEventListener('load', function() {
            checkPWAStatus();
            addHomeButtonToNewContent();
            
            observer.observe(document.body, {
                childList: true,
                subtree: true
            });
        });
        
        // Ù„Ù„ØµÙØ­Ø§Øª Ø§Ù„ØªÙŠ ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„Ù‡Ø§ Ø¹Ø¨Ø± AJAX
        if (typeof jQuery !== 'undefined') {
            $(document).ajaxComplete(function() {
                setTimeout(addHomeButtonToNewContent, 100);
            });
        }
    </script>
</body>
</html>
