<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ù…ÙˆÙ„Ø¯ ØªØ·Ø¨ÙŠÙ‚ ÙˆÙŠØ¨ Ù„Ø¢ÙŠÙÙˆÙ†</title>
<style>
body {
  font-family: "Tajawal", sans-serif;
  direction: rtl;
  text-align: center;
  background: #f2f2f2;
  padding: 20px;
}
input, button {
  margin: 10px;
  padding: 10px;
  border-radius: 8px;
  border: 1px solid #ccc;
  width: 80%;
}
button {
  background: #007aff;
  color: white;
  border: none;
  cursor: pointer;
  font-size: 16px;
}
button:hover {
  background: #0059c1;
}
img {
  max-width: 100px;
  margin-top: 10px;
  border-radius: 20%;
  box-shadow: 0 0 5px #999;
}
.footer {
  margin-top: 40px;
  font-size: 16px;
  color: #444;
  font-weight: bold;
  animation: glow 1.5s ease-in-out infinite alternate;
}
@keyframes glow {
  from { color: #007aff; }
  to { color: #ff0080; }
}
</style>
</head>
<body>

<h2>ğŸ“± Ù…ÙˆÙ„Ø¯ ØªØ·Ø¨ÙŠÙ‚ ÙˆÙŠØ¨ Ù„Ø¢ÙŠÙÙˆÙ†</h2>
<p>Ø£Ø¯Ø®Ù„ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ø«Ù… Ø§Ø¶ØºØ· "ØªÙˆÙ„ÙŠØ¯ Ù…Ù„Ù Ø§Ù„ØªØ¹Ø±ÙŠÙ"</p>

<input type="text" id="appName" placeholder="Ø§Ø³Ù… Ø§Ù„ØªØ·Ø¨ÙŠÙ‚">
<input type="url" id="appUrl" placeholder="Ø±Ø§Ø¨Ø· Ø§Ù„Ù…ÙˆÙ‚Ø¹">
<input type="file" id="iconInput" accept="image/*">
<br>
<img id="preview" style="display:none;"/><br>
<button onclick="generateProfile()">ØªÙˆÙ„ÙŠØ¯ Ù…Ù„Ù Ø§Ù„ØªØ¹Ø±ÙŠÙ</button>

<p class="footer">Ø¨Ø±Ù…Ø¬Ø© Ø­Ø³ÙŠÙ† Ø§Ù„Ø¹Ø±ÙŠØ§Ù†ÙŠ ğŸ’¥</p>

<script>
function generateProfile() {
  const appName = document.getElementById("appName").value || "ØªØ·Ø¨ÙŠÙ‚ÙŠ";
  const appUrl = document.getElementById("appUrl").value;
  const iconInput = document.getElementById("iconInput");
  
  if (!appUrl) {
    alert("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ø§Ø¨Ø· Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø£ÙˆÙ„Ø§Ù‹");
    return;
  }

  const reader = new FileReader();
  reader.onload = function(e) {
    const iconBase64 = e.target.result.replace(/^data:image\/(png|jpeg);base64,/, '');
    const uuid = crypto.randomUUID();

    // ÙƒÙˆØ¯ Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø±Ø¬ÙˆØ¹ ÙˆØ§Ù„ØªÙ‚Ø¯Ù… Ù„ÙŠØªÙ… Ø¥Ø¶Ø§ÙØªÙ‡ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¯Ø§Ø®Ù„ ØµÙØ­Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
    const navButtonsCode = `
<!-- Ø£Ø²Ø±Ø§Ø± Ø±Ø¬ÙˆØ¹ ÙˆØªÙ‚Ø¯Ù… ØµØºÙŠØ±Ø© -->
<style>
.nav-buttons {
  position: fixed;
  bottom: 10px;
  left: 10px;
  display: flex;
  gap: 8px;
  z-index: 9999;
}
.nav-btn {
  background: rgba(0, 0, 0, 0.4);
  color: white;
  border: none;
  border-radius: 50%;
  width: 28px;
  height: 28px;
  font-size: 14px;
  line-height: 28px;
  text-align: center;
  cursor: pointer;
  transition: 0.3s;
}
.nav-btn:hover {
  background: #007aff;
}
</style>
<div class='nav-buttons'>
  <button class='nav-btn' onclick='history.back()'>â¬…ï¸</button>
  <button class='nav-btn' onclick='history.forward()'>â¡ï¸</button>
</div>`;

    const injectedUrl = appUrl.includes("?") 
      ? appUrl + "&navbuttons=1" 
      : appUrl + "?navbuttons=1";

    const dataUrl = `data:text/html;charset=utf-8,${encodeURIComponent(`
<!DOCTYPE html>
<html lang="ar">
<head><meta charset='UTF-8'><meta name='viewport' content='width=device-width,initial-scale=1.0'></head>
<body style='margin:0;padding:0;'>
<iframe src='${injectedUrl}' style='width:100vw;height:100vh;border:none;'></iframe>
${navButtonsCode}
</body>
</html>`)}`
    
    const profile = `<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
<dict>
 <key>PayloadContent</key>
 <array>
  <dict>
   <key>FullScreen</key><true/>
   <key>IgnoreManifestScope</key><true/>
   <key>Icon</key><data>${iconBase64}</data>
   <key>IsRemovable</key><true/>
   <key>Label</key><string>${appName}</string>
   <key>PayloadDescription</key><string>${appName}</string>
   <key>PayloadDisplayName</key><string>${appName}</string>
   <key>PayloadIdentifier</key><string>com.hussain.${uuid}</string>
   <key>PayloadOrganization</key><string>Ø¨Ø±Ù…Ø¬Ø© Ø­Ø³ÙŠÙ† Ø§Ù„Ø¹Ø±ÙŠØ§Ù†ÙŠ</string>
   <key>PayloadType</key><string>com.apple.webClip.managed</string>
   <key>PayloadUUID</key><string>${uuid}</string>
   <key>PayloadVersion</key><integer>1</integer>
   <key>Precomposed</key><true/>
   <key>URL</key><string>${dataUrl}</string>
  </dict>
 </array>
 <key>PayloadDescription</key><string>Ø¨Ø±Ù…Ø¬Ø© Ø­Ø³ÙŠÙ† Ø§Ù„Ø¹Ø±ÙŠØ§Ù†ÙŠ</string>
 <key>PayloadDisplayName</key><string>${appName}</string>
 <key>PayloadIdentifier</key><string>profile.${uuid}</string>
 <key>PayloadType</key><string>Configuration</string>
 <key>PayloadUUID</key><string>${uuid}</string>
 <key>PayloadVersion</key><integer>1</integer>
</dict>
</plist>`;

    const blob = new Blob([profile], { type: "application/x-apple-aspen-config" });
    const link = document.createElement("a");
    link.href = URL.createObjectURL(blob);
    link.download = appName + ".mobileconfig";
    link.click();
  };

  if (iconInput.files[0]) {
    reader.readAsDataURL(iconInput.files[0]);
  } else {
    reader.onload({ target: { result: "data:image/png;base64," } }); // Ø¨Ø¯ÙˆÙ† Ø£ÙŠÙ‚ÙˆÙ†Ø©
  }
}

document.getElementById("iconInput").addEventListener("change", e => {
  const file = e.target.files[0];
  if (file) {
    const reader = new FileReader();
    reader.onload = ev => {
      const img = document.getElementById("preview");
      img.src = ev.target.result;
      img.style.display = "block";
    };
    reader.readAsDataURL(file);
  }
});
</script>

</body>
</html>
